{% extends 'core/base.html' %}
{% load static %}

{% block title %}Rate Limit Exceeded{% endblock %}

{% block content %}
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow-lg border-danger">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <div style="font-size: 4rem; color: #dc3545; margin-bottom: 1rem;">
                            <i class="fas fa-exclamation-shield"></i>
                        </div>
                        <h1 class="text-danger">Too Many Attempts</h1>
                        <p class="text-muted mt-3">{{ message }}</p>
                    </div>
                    
                    <!-- Rate Limit Timer -->
                    <div class="alert alert-danger mb-4" role="alert">
                        <div class="d-flex align-items-center justify-content-center">
                            <i class="fas fa-hourglass me-3" style="font-size: 2rem;"></i>
                            <div>
                                <div class="small">Please wait before trying again</div>
                                <div style="font-size: 2rem; font-weight: bold;" id="retryTimer">15:00</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info" role="alert">
                        <i class="fas fa-shield-alt me-2"></i>
                        <strong>Why are you seeing this?</strong>
                        <p class="mb-0 mt-2">This is a security measure to protect your account from unauthorized access. Multiple failed attempts trigger this protection.</p>
                    </div>
                    
                    <div class="alert alert-warning" role="alert">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Tips:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Make sure you're entering the correct credentials</li>
                            <li>Check your email for OTP codes</li>
                            <li>If you're locked out, contact support</li>
                            <li>This restriction will automatically reset after the timer expires</li>
                        </ul>
                    </div>
                    
                    <div class="text-center mt-4">
                        <a href="/" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Go Back to Home
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="{% static 'js/timer.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get retry-after from meta tag or default to 900 seconds (15 minutes)
            const retryAfter = parseInt(document.querySelector('meta[name="retry-after"]')?.content || '900');
            
            // Start rate limit timer
            const timer = new CountdownTimer('retryTimer', retryAfter, function() {
                // Redirect back when timer expires
                window.location.href = '{{ redirect_url|default:"/" }}';
            });
            timer.start();
        });
    </script>
{% endblock %}
